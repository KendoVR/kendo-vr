<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Untitled</title>
  <script src="https://kendo.cdn.telerik.com/2018.3.911/js/jquery.min.js"></script>
  <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script> 
  <script src="https://unpkg.com/aframe-debug-cursor-component/dist/aframe-debug-cursor-component.min.js"></script>
  <script src="./kendo-webvr-ddl/aframe-ddl.js"></script>
  <script src="./kendo-webvr-grid/aframe-grid.js"></script>
  <script src="./kendo-webvr-switch/aframe-switch.js"></script>
  <script src="./kendo-webvr-chart/aframe-chart.js"></script>
  <script src="https://kendo.cdn.telerik.com/2018.3.911/js/kendo.all.min.js"></script>
</head>
<body>
  <a-scene>
	<a-assets>
			<kendo-webvr-switch onchange="onSwitchClick(this)" class="checkbox" checked="true" width="15" height="7" position="0 0 0.2" padding="0.55"></kendo-webvr-switch>
			<img id="desc" src="./assets/arrow-down.svg" />
			<img id="asc" src="./assets/arrow-up.svg" />
			<img id="upGradient" src="./assets/scroll_gradient-up.png" />
			<img id="downGradient" src="./assets/scroll_gradient-down.png" />
			<img id="scrollDown" src="./assets/arrow-chevron-down-active.svg" />
			<img id="scrollUp" src="./assets/arrow-chevron-up-active.svg" />
	</a-assets>

    <a-entity light="type: ambient; color: #FFF"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.1" position="-0.5 1 1"></a-entity>
    <a-entity id="mouseCursor" cursor="rayOrigin: mouse"></a-entity>

	<!-- MultiView START -->
	<a-entity id="k-view-wrapper" position="-100 300 -300" scale="50 50 50">
		<kendo-webvr-dropdownlist id="chart-shade-choser" value="Polychrome View" position="-3 0 0" width="4" opacity="0.8" row-height="0.64"></kendo-webvr-dropdownlist>
		
		<a-plane class="k-view-button" width="1" height="1" position="0 0 0" src="./assets/view-chart-normal.svg" data-altsvg="./assets/view-chart-selected.svg" data-selected="false" data-hovered="false" data-val="chart-view"></a-plane>
		<a-plane class="k-view-button" width="1" height="1" position="1.5 0 0" src="./assets/view-chart-grid-selected.svg" data-altsvg="./assets/view-chart-grid-normal.svg" data-selected="true" data-hovered="false" data-val="chart-grid-view"></a-plane>
		<a-plane class="k-view-button" width="1" height="1" position="3 0 0" src="./assets/view-grid-normal.svg" data-altsvg="./assets/view-grid-selected.svg" data-selected="false" data-hovered="false" data-val="grid-view"></a-plane>
	</a-entity>
	<!-- MultiView END -->

	<!-- CAMERA START -->
    <a-entity position="0 0 250" rotation="0 0 0" id="camera-wrapper">
        <a-entity camera="fov: 60; far: 10000" id="camera-entity" look-controls wasd-controls>
            <a-entity cursor="fuse: false;"
                position="0 0 -40"
                geometry="primitive: ring; radiusInner: 0.3; radiusOuter: 0.5"
                material="color: #888; shader: flat">
            </a-entity>
        </a-entity>
	</a-entity>
	<!-- CAMERA END -->
	
	<!-- CHART START -->
	<kendo-webvr-chart id="chart"
					   x-axis="income" 
					   y-axis="profit" 
					   z-axis="incomeChange"
					   size-field="employees"
					   item-title="company"
					   data-src="./companies-data.json"
					   x-axis-scale="0.000001"
					   y-axis-scale="0.00001"
					   size-scale="0.016"
					   color="#199cad"
					   rotation="30 -45 -20"
					   scale="0.7 0.7 0.7"></kendo-webvr-chart>
	<!-- <a-entity id="container" rotation="30 -45 -20" scale="0.7 0.7 0.7"></a-entity> -->
	<!-- CHART END -->
	
	<!-- GRID START -->
	<kendo-webvr-grid id="grid" 
						visibleto="2"
						pageSize="10"
						position="160 100 -0.1"
						data="./companies-data.json"
						height="320"
						sortable="true">    
	</kendo-webvr-grid>
	<!-- GRID END -->

	<a-cylinder opacity="0.5" transparent="true" height="500" radius="500" repeat="8" position="0 100 0" rotation="0 0 0" open-ended="true" side="double" src="./assets/city_landscape.svg"></a-cylinder>

	<a-plane opacity="0.1" transparent="true" color="gray" height="10000" width="10000" rotation="-90 0 0" position="0 -175 0" side="double" ></a-plane>

	<a-sky color="#eff2f5"></a-sky>

</a-scene>


<script>
	function switchImage(src) {
		var altSvg = src.getAttribute("data-altsvg");
		src.setAttribute("data-altsvg", src.getAttribute("src"));
		src.setAttribute("src", altSvg);
	}

	function onSwitchClick(ev) {            
		var isChecked = ev.components.switch.data.checked;
		var rowIndex = ev.parentEl.getAttribute('rowIndex');

		let cols = ev.parentEl.parentEl.getChildEntities().filter(item => item.getAttribute("rowIndex") == rowIndex);

		for(let col of cols) {
			if(isChecked) {
				col.setAttribute('material', { opacity: 0.9 });
			} else {
				col.setAttribute('material', { opacity: 0.7 });
			}
		}
	}

	window.addEventListener("viewchanged", function (ev) {
		if (ev.detail.view == "grid-view") {
			document.getElementById("grid").setAttribute("visibleTo", 6)
		}
	})
</script>

	<script>
		window.onload = function() {
			var viewWrapper = document.querySelector("#k-view-wrapper");
			
			viewWrapper.addEventListener("mouseenter", function(ev){
				if(ev.srcElement.className === "k-view-button" && ev.srcElement.getAttribute("data-selected") === "false" && ev.srcElement.getAttribute("data-hovered") === "false") {
					switchImage(ev.srcElement);
					ev.srcElement.setAttribute("data-hovered", "true");
				}
			});

			viewWrapper.addEventListener("mouseleave", function(ev){
				if(ev.srcElement.className === "k-view-button" && ev.srcElement.getAttribute("data-selected") === "false" && ev.srcElement.getAttribute("data-hovered") === "true") {
					switchImage(ev.srcElement);
					ev.srcElement.setAttribute("data-hovered", "false");
				}
			});

			viewWrapper.addEventListener("click", function(ev){
				if(ev.srcElement.className === "k-view-button" && ev.srcElement.getAttribute("data-selected") === "false") {
					var selectedItem = document.querySelector("[data-selected='true']");
					switchImage(selectedItem);
					ev.srcElement.setAttribute("data-selected", "true");
					ev.srcElement.setAttribute("data-hovered", "false");
					selectedItem.setAttribute("data-selected", "false");

					window.dispatchEvent(new CustomEvent("viewchanged", {detail: {view: ev.srcElement.getAttribute("data-val")}}));
				}
			});

			var ddl = document.getElementById('chart-shade-choser');

			ddl.addEventListener("change", function (ev) {
				var chart = document.getElementById('chart');
				var selectedShade = ev.detail.newValue;
				var chartItems = document.getElementsByClassName('chart-item');

				if (selectedShade === 'Polychrome View') {
					for(var i = 0; i < chartItems.length; i++) {
						loadMultiColorsForData(i, chartItems[i]);
					}

				} else if (selectedShade === 'Monochrome View') {
					for(var i = 0; i < chartItems.length; i++) {
						loadSingleColorForData('#199cad', chartItems[i]);
					}
				} else if (selectedShade === 'Bichrome View') {
					for(var i = 0; i < chartItems.length; i++) {
						loadGreenRedShadingForData(chartItems[i].getAttribute('data-profit'), chartItems[i]);
					}
				}
			});

			var vSwitch = document.querySelectorAll('.checkbox')[0];
            
            function onSwitchClick(ev) {            
                var isChecked = ev.components.switch.data.checked;
                var rowIndex = ev.parentEl.getAttribute('rowIndex');

                let cols = ev.parentEl.parentEl.getChildEntities().filter(item => item.getAttribute("rowIndex") == rowIndex);

                for(let col of cols) {
                    if(isChecked) {
                        col.setAttribute('material', { opacity: 0.9 });
                    } else {
                        col.setAttribute('material', { opacity: 0.7 });
                    }
                }
            }
		}
	</script>
</body>
</html>